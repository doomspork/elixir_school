Travailler avec l'heure en Elixir.

## Temps

Elixir possède quelques modules qui travaillent avec le temps.
Commençons par obtenir l'heure actuelle :

```elixir
iex> Time.utc_now
~T[19:39:31.056226]
```

Notez que nous avons un sigil qui peut être utilisé pour créer une structure `Time` également :

```elixir
iex> ~T[19:39:31.056226]
~T[19:39:31.056226]
```

Vous pouvez en apprendre davantage sur les sigils dans la [leçon sur les sigils](/fr/lessons/basics/sigils).
Il est facile d'accéder à certaines parties de cette structure :

```elixir
iex> t = ~T[19:39:31.056226]
~T[19:39:31.056226]
iex> t.hour
19
iex> t.minute
39
iex> t.day
** (KeyError) key :day not found in : ~T[19:39:31.056226]
```

Mais il y a un hic : comme vous l'avez peut-être remarqué, cette structure ne contient que l'heure dans un jour, aucune donnée sur le jour, le mois ou l'année n'est présente.

## Date

Contrairement à `Time`, une structure `Date` contient des informations sur la date, sans aucune information sur l'heure.

```elixir
iex> Date.utc_today
~D[2028-10-21]
```

Et il possède quelques fonctions utiles pour travailler avec les dates :

```elixir
iex> {:ok, date} = Date.new(2020, 12, 12)
{:ok, ~D[2020-12-12]}
iex> Date.day_of_week date
6
iex> Date.leap_year ? date
true
```

`day_of_week/1` calcule le jour de la semaine d'une date donnée.
Dans ce cas, c'est samedi.
`leap_year?/1` vérifie si c'est une année bissextile.
D'autres fonctions peuvent être trouvées dans [doc](https://hexdocs.pm/elixir/Date.html).

## NaiveDateTime

Il existe deux types de structures qui contiennent à la fois la date et l'heure en Elixir.
Le premier est `NaiveDateTime`.
Son inconvénient est le manque de support des fuseaux horaires :

```elixir
iex(15)> NaiveDateTime.utc_now
~N[2022-01-21 19:55:10.008965]
```

Mais il possède à la fois l'heure et la date, vous pouvez donc jouer avec l'ajout de l'heure, par exemple :

```elixir
iex> NaiveDateTime.add(~N[2018-10-01 00:00:14], 30)
~N[2018-10-01 00:00:44]
```

## DateTime

La seconde, comme vous l'avez peut-être deviné d'après le titre de cette section, est `DateTime`.
Il n'a pas les limitations notées dans `NaiveDateTime` : il a à la fois l'heure et la date, et supporte les fuseaux horaires.
Mais attention aux fuseaux horaires. La documentation officielle indique :

> De nombreuses fonctions de ce module nécessitent une base de données de fuseaux horaires. Par défaut, il utilise la base de données de fuseau horaire retournée par `Calendar.get_time_zone_database/0`, qui utilise par défaut `Calendar.UTCOnlyTimeZoneDatabase` qui ne gère que les dates "Etc/UTC" et retourne `{:error, :utc_only_time_zone_database}` pour tout autre fuseau horaire.

Notez également que vous pouvez créer une instance de DateTime à partir de NaiveDateTime, en fournissant simplement le fuseau horaire :

``elixir
iex> DateTime.from_naive(~N[2016-05-24 13:26:08.003], "Etc/UTC")
{:ok, #DateTime<2016-05-24 13:26:08.003Z>}
```

## Travailler avec les fuseaux horaires

Comme nous l'avons noté dans la section précédente, par défaut Elixir ne dispose pas de données de fuseau horaire.
Pour résoudre ce problème, nous devons installer et configurer le paquet [tzdata](https://github.com/lau/tzdata).
Après l'avoir installé, vous devez configurer globalement Elixir pour utiliser Tzdata comme base de données de fuseau horaire :

```elixir
config :elixir, :time_zone_database, Tzdata.TimeZoneDatabase
```

Essayons maintenant de créer une heure dans le fuseau horaire de Paris et de la convertir en heure de New York :

```elixir
iex> paris_datetime = DateTime.from_naive !(~N[2019-01-01 12:00:00], "Europe/Paris")
#DateTime<2019-01-01 12:00:00+01:00 CET Europe/Paris>
iex> {:ok, ny_datetime} = DateTime.shift_zone(paris_datetime, "America/New_York")
{:ok, #DateTime<2019-01-01 06:00:00-05:00 EST Amérique/New_York>}
iex> ny_datetime
#DateTime<2019-01-01 06:00:00-05:00 EST Amérique/New_York>
```

Comme vous pouvez le voir, l'heure est passée de 12:00 heure de Paris à 6:00, ce qui est correct - le décalage horaire entre les deux villes est de 6 heures.

C'est tout ! Si vous souhaitez travailler avec d'autres fonctions avancées, vous pouvez envisager de consulter la documentation sur [Time](https://hexdocs.pm/elixir/Time.html), [Date](https://hexdocs.pm/elixir/Date.html), [DateTime](https://hexdocs.pm/elixir/DateTime.html) et [NaiveDateTime](https://hexdocs.pm/elixir/NaiveDateTime.html).
Vous devriez également considérer [Timex](https://github.com/bitwalker/timex) et [Calendar](https://github.com/lau/calendar) qui sont des bibliothèques puissantes pour travailler avec le temps dans Elixir.

Documentation du code Elixir.

## Annotation

La quantité de commentaires et ce qui constitue une documentation de qualité reste une question controversée dans le monde de la programmation.
Cependant, nous pouvons tous convenir que la documentation est importante pour nous-mêmes et pour ceux qui travaillent avec notre base de code.

Elixir traite la documentation comme un *citoyen de première classe*, offrant diverses fonctions pour accéder à la documentation et la générer pour vos projets.
Le noyau d'Elixir nous fournit de nombreux attributs différents pour annoter une base de code.
Examinons trois façons :

  - `#` - Pour la documentation en ligne.
  - `@moduledoc` - Pour la documentation au niveau du module.
  - `@doc` - Pour la documentation au niveau des fonctions.

### Documentation en ligne

La façon la plus simple de commenter votre code est probablement avec les commentaires en ligne.
Similaire à Ruby ou Python, le commentaire en ligne d'Elixir est indiqué par un `#`, fréquemment connu sous le nom de *pound*, ou *hash* selon l'endroit où vous vous trouvez dans le monde.

Prenez ce script Elixir (greeting.exs) :

```elixir
# Affiche 'Hello, chum.' sur la console.
IO.puts("Hello, " <> "chum.")
```

Elixir, lors de l'exécution de ce script, ignorera tout ce qui va de `#` à la fin de la ligne, le traitant comme des données à jeter.
Il se peut que cela n'apporte aucune valeur ajoutée au fonctionnement ou aux performances du script, cependant quand ce n'est pas si évident ce qui se passe un programmeur devrait le savoir en lisant votre commentaire.
Veillez à ne pas abuser du commentaire d'une seule ligne ! Jeter des déchets dans une base de code pourrait devenir un cauchemar indésirable pour certains.
Il est préférable de l'utiliser avec modération.

### Documenter les modules

L'annotateur `@moduledoc` permet la documentation en ligne au niveau du module.
Il se situe typiquement juste en dessous de la déclaration `defmodule` en haut d'un fichier.
L'exemple ci-dessous montre un commentaire d'une ligne dans le décorateur `@moduledoc`.

```elixir
defmodule Greeter do
  @moduledoc """
  Fournit une fonction `hello/1` pour accueillir un humain.
  """

  def hello(name) do
    "Bonjour, " <> nom
  end
end
```

Nous (ou d'autres) pouvons accéder à la documentation de ce module en utilisant la fonction d'aide `h` dans IEx.
Nous pouvons le constater par nous-mêmes si nous plaçons notre module `Greeter` dans un nouveau fichier, `greeter.ex` et le compilons :

```elixir
iex> c("greeter.ex", ".")
[Greeter]

iex> h Greeter

                Greeter

Fournit une fonction hello/1 pour accueillir un humain
```

Remarque : nous n'avons pas besoin de compiler manuellement nos fichiers comme nous l'avons fait ci-dessus si nous travaillons dans le contexte d'un projet mix. Vous pouvez utiliser `iex -S mix` pour charger la console IEx pour le projet actuel si vous travaillez dans un projet mix.

### Documenter les fonctions

Tout comme Elixir nous donne la possibilité d'annoter au niveau du module, il permet également des annotations similaires pour documenter les fonctions.
L'annotateur `@doc` permet la documentation en ligne au niveau de la fonction.
L'annotateur `@doc` se situe juste au-dessus de la fonction qu'il annote.

```elixir
defmodule Greeter do
  @moduledoc """
  ...
  """

  @doc """
  Imprime un message d'accueil.

  ## Paramètres

    - name : Chaîne représentant le nom de la personne.

  ## Exemples

      iex> Greeter.hello("Sean")
      "Bonjour, Sean"

      iex> Greeter.hello("pete")
      "Bonjour, Pete"

  """
  @spec hello(String.t()) : : String.t()
  def hello(name) do
    "Bonjour, " <> nom
  end
end
```

Si nous nous lançons à nouveau dans IEx et utilisons la commande d'aide (`h`) sur la fonction précédée du nom du module, nous devrions voir ce qui suit :

```elixir
iex> c("greeter.ex", ".")
[Greeter]

iex> h Greeter.hello

                def hello(nom)

  @spec hello(String.t()) : : String.t()

Imprime un message d'accueil.

Paramètres

  - name : Chaîne qui représente le nom de la personne.

Exemples

    iex> Greeter.hello("Sean")
    "Bonjour, Sean"

    iex> Greeter.hello("pete")
    "Bonjour, Pete"

iex>
```

Vous avez remarqué que vous pouvez utiliser des balises dans notre documentation et que le terminal les rendra ? En plus d'être vraiment cool et d'apporter une nouveauté au vaste écosystème d'Elixir, cela devient beaucoup plus intéressant si l'on regarde ExDoc pour générer de la documentation HTML à la volée.

**Remarque : l'annotation `@spec` est utilisée pour l'analyse statique du code.
Pour en savoir plus, consultez la leçon [Spécifications et types](/fr/lessons/advanced/typespec).

## ExDoc

ExDoc est un projet Elixir officiel qui se trouve sur [GitHub](https://github.com/elixir-lang/ex_doc).
Il produit du **HTML (HyperText Markup Language) et de la documentation en ligne** pour les projets Elixir.
Tout d'abord, créons un projet Mix pour notre application :

```bash
$ mix new greet_everyone

* Création du fichier README.md
* Création du fichier .formatter.exs
* Création de .gitignore
* création de mix.exs
* creating lib
* Création de lib/greet_everyone.ex
* création de test
* création de test/test_helper.exs
* Création de test/greet_everyone_test.exs

Votre projet Mix a été créé avec succès.
Vous pouvez utiliser "mix" pour le compiler, le tester, et plus encore :

    cd greet_everyone
    mix test

Exécutez "mix help" pour plus de commandes.

$ cd greet_everyone

```

Maintenant, copiez et collez le code de la leçon de l'annotateur `@doc` dans un fichier appelé `lib/greeter.ex` et vérifiez que tout fonctionne toujours depuis la ligne de commande.
Maintenant que nous travaillons dans un projet Mix, nous devons démarrer IEx un peu différemment en utilisant la séquence de commandes `iex -S mix` :

```elixir
iex> h Greeter.hello

                def hello(nom)

  @spec hello(String.t()) : : String.t()

Imprime un message d'accueil.

Paramètres

  - name : Chaîne qui représente le nom de la personne.

Exemples

    iex> Greeter.hello("Sean")
    "Bonjour, Sean"

    iex> Greeter.hello("pete")
    "Bonjour, Pete"
```

### Installation

En supposant que tout va bien et que nous voyons le résultat ci-dessus, nous sommes maintenant prêts à installer ExDoc.
Dans le fichier `mix.exs`, ajoutez la dépendance `:ex_doc` pour commencer.

```elixir
  def deps do
    {:ex_doc, "~> 0.21", only : :dev, runtime : false}]]
  end
```

Nous spécifions la paire clé-valeur `only : :dev` car nous ne voulons pas télécharger et compiler la dépendance `ex_doc` dans un environnement de production.

`ex_doc` va également ajouter une autre bibliothèque pour nous, Earmark.

Earmark est un analyseur Markdown pour le langage de programmation Elixir qu'ExDoc utilise pour transformer notre documentation dans `@moduledoc` et `@doc` en un magnifique HTML.

Il est intéressant de noter à ce stade que vous pouvez changer l'outil de balisage pour Cmark si vous le souhaitez, mais vous aurez besoin d'un peu plus de configuration que vous pouvez lire [ici](https://hexdocs.pm/ex_doc/ExDoc.Markdown.html#module-using-cmark).
Pour ce tutoriel, nous nous contenterons d'utiliser Earmark.

### Génération de la documentation

Continuez, depuis la ligne de commande, lancez les deux commandes suivantes :

```bash
$ mix deps.get # obtient ExDoc + Earmark.
$ mix docs # génère la documentation.

Les docs ont été générés avec succès.
Vous pouvez les consulter à l'adresse "doc/index.html".
```

Si tout s'est déroulé comme prévu, vous devriez voir un message similaire au message de sortie de l'exemple ci-dessus.
Regardons maintenant dans notre projet Mix et nous devrions voir qu'il y a un autre répertoire appelé **doc/**.
Ce répertoire contient notre documentation générée.
Si nous visitons la page d'index dans notre navigateur, nous devrions voir ce qui suit :

![ExDoc Screenshot 1](/images/documentation_1.png)

Nous pouvons voir que Earmark a rendu notre Markdown et qu'ExDoc l'affiche maintenant dans un format utile.

![ExDoc Screenshot 2](/images/documentation_2.png)

Nous pouvons maintenant déployer ce document sur GitHub, notre propre site web, ou plus communément [HexDocs](https://hexdocs.pm/).

## Meilleure pratique

La documentation doit être ajoutée dans le cadre des directives de bonnes pratiques du langage.
Elixir étant un langage relativement jeune, de nombreuses normes doivent encore être découvertes au fur et à mesure que l'écosystème se développe.
La communauté a toutefois essayé d'établir des meilleures pratiques.
Pour en savoir plus sur les meilleures pratiques, consultez [The Elixir Style Guide] (https://github.com/niftyn8/elixir_style_guide).

  - Toujours documenter un module.

```elixir
defmodule Greeter do
  @moduledoc """
  Ceci est une bonne documentation.
  """

end
```

  - Si vous n'avez pas l'intention de documenter un module, **ne** le laissez pas vide.
Pensez à annoter le module `false`, comme ceci :

```elixir
defmodule Greeter do
  @moduledoc false

end
```

 - Lorsque vous faites référence à des fonctions dans la documentation d'un module, utilisez des retours arrière comme suit :

```elixir
defmodule Greeter do
  @moduledoc """
  ...

  Ce module possède également une fonction `hello/1`.
  """

  def hello(name) do
    IO.puts("Bonjour, " <> nom)
  end
end
```

 - Séparez tout le code d'une ligne sous le `@moduledoc` comme suit :

```elixir
defmodule Greeter do
  @moduledoc """
  ...

  Ce module possède également une fonction `hello/1`.
  """

  alias Adieu.bye_bye
  # et ainsi de suite...

  def hello(name) do
    IO.puts("Bonjour, " <> nom)
  end
end
```

 - Utilisez Markdown dans les docs.
Cela rendra la lecture plus facile, que ce soit via IEx ou ExDoc.

```elixir
defmodule Greeter do
  @moduledoc """
  ...
  """

  @doc """
  Imprime un message d'accueil

  ## Paramètres

    - name : Chaîne qui représente le nom de la personne.

  ## Exemples

      iex> Greeter.hello("Sean")
      "Bonjour, Sean"

      iex> Greeter.hello("pete")
      "Bonjour, Pete"

  """
  @spec hello(String.t()) : : String.t()
  def hello(name) do
    "Bonjour, " <> nom
  end
end
```

 - Essayez d'inclure quelques exemples de code dans votre documentation.
Cela vous permet également de générer des tests automatiques à partir des exemples de code trouvés dans un module, une fonction ou une macro avec [ExUnit.DocTest][].
Pour ce faire, vous devez invoquer la macro `doctest/1` à partir de votre scénario de test et écrire vos exemples en suivant certaines directives détaillées dans la [documentation officielle] [ExUnit.DocTest].

[ExUnit.DocTest] : https://hexdocs.pm/ex_unit/ExUnit.DocTest.html
